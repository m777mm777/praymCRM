<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GET Request with Multiple Objects</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #808080;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        :root {
            --height-top: calc(15vw); /* 18% от ширины экрана */
        }

        .login-container1 {
            position: fixed;
            top: 7px;
            left: 220px;
            width: 25%;
            height: var(--height-top);
            background-color: #91CCC2; /* зеленовато-голубой цвет фона */
            padding: 5px 10px;
            border: 2px solid #ffffff; /* Черная рамка */
            outline: 4px solid #000000; /* Белая рамка вокруг черной */
            border-radius: 10px; /* Скругление углов */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .login-container2 {
            position: fixed;
            top: 7px;
            right: 10px;
            width: 50%;
            height: var(--height-top);
            background-color: #91CCC2; /* зеленовато-голубой цвет фона */
            padding: 5px 10px;
            border: 2px solid #ffffff; /* Черная рамка */
            outline: 4px solid #000000; /* Белая рамка вокруг черной */
            border-radius: 10px; /* Скругление углов */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .login-container {
            position: fixed;
            top: calc(var(--height-top) + 4%);
            left: 5px;
            background-color: #91CCC2; /* зеленовато-голубой цвет фона */
            padding: 5px 15px;
            border: 2px solid #ffffff; /* Черная рамка */
            outline: 4px solid #000000; /* Белая рамка вокруг черной */
            border-radius: 5px; /* Скругление углов */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 97.5%;
<!--            text-align: center;-->
        }
        .back-container {
            position: fixed;
            top: 5px;
            left: 5px;
        }
        .inf-container {

            margin-top: 550px;

            background-color: #91CCC2; /* зеленовато-голубой цвет фона */
            padding: 20px;
            border: 2px solid #ffffff; /* Черная рамка */
            outline: 4px solid #000000; /* Белая рамка вокруг черной */
            border-radius: 10px; /* Скругление углов */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 99%;
            text-align: center;
        }
        .logo {
            width: 150px;
            margin-bottom: 20px;
        }
        input[type="text"], input[type="password"] {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }

                .polya1 {
        background-color: #e3e8e6; /* бело-серый цвет фона */
        color: #000000; /* Черный цвет текста */
        border: 2px solid #000000; /* Черная рамка */
        outline: 4px solid #ffffff; /* Белая рамка вокруг черной */
        border-radius: 7px; /* Скругление углов */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Опционально: Добавление тени */
        margin-top: 12px;
        width: 120px;
<!--        padding: 2px; /* Отступ внутри элемента */-->
        font-size: 14px;
    }

                 .polya {
        background-color: #e3e8e6; /* бело-серый цвет фона */
        color: #000000; /* Черный цвет текста */
        border: 2px solid #000000; /* Черная рамка */
        outline: 4px solid #ffffff; /* Белая рамка вокруг черной */
        border-radius: 7px; /* Скругление углов */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Опционально: Добавление тени */
        padding: 10px; /* Отступ внутри элемента */
        font-size: 14px;
    }

        .bbtn {
  font-size: 1.5rem; /* Устанавливает размер шрифта */
  border: 2px solid white; /* Добавляет белую рамку */
  border-radius: 10px; /* Скругляет углы */
  font-size: 12px;
    color: #000; /* Меняет цвет текста */
  font-weight: 700; /* жирность шрифта от 100 до 900 */
  width: 150px; /* Устанавливает ширину */
  height: 40px; /* Устанавливает высоту */
  padding: 5px; /* Добавляет внутренний отступ */
  background-color: transparent; /* Делает фон прозрачным */
  transition: 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); /* Анимация */
}

.bbtn:hover {
  width: 200px; /* Увеличивает ширину при наведении */
  background-color: #91CCC2; /* Меняет фон на голубой при наведении */
  box-shadow: 0px 5px 5px rgba(0, 0, 0, 0.2); /* Добавляет тень */
  font-size: 16px;
  color: #000; /* Меняет цвет текста */
  transition: 0.3s; /* Анимация при наведении */
}

.bbtn:active {
  background-color: rgba(255, 255, 255, 0.8); /* Полупрозрачный белый фон при нажатии */
  box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2); /* Уменьшает тень */
  transition: 0.05s; /* Анимация при нажатии */
}

.bold-text {
    font-weight: 700;
}

.box {
   border: 2px solid #000000; /* Черная рамка */
   outline: 4px solid #ffffff; /* Белая рамка вокруг черной */
}

     /* Общие стили для тултипа */
    .tooltip {
        position: relative;
        display: inline-block;
    }

    .tooltip .tooltiptext {
        visibility: hidden;
        width: 160px;
        background-color: rgba(85, 85, 85, 0.9); /* Полупрозрачный фон */
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        opacity: 0; /* Начальная прозрачность */
        transition: opacity 0.3s;
    }

    .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 0.9; /* Полупрозрачность при наведении */
    }

    /* Стили для тултипа слева */
    .tooltip-left .tooltiptext {
        right: 105%; /* Позиция слева от кнопки */
        top: 50%;
        transform: translateY(-50%); /* Центрирование по вертикали */
    }

    .tooltip-left .tooltiptext::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 100%; /* Стрелка справа от тултипа */
        margin-top: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: transparent transparent transparent rgba(85, 85, 85, 0.9); /* Полупрозрачная стрелка */
    }

    /* Стили для тултипа снизу */
    .tooltip-bottom .tooltiptext {
        top: 105%; /* Позиция снизу от кнопки */
        left: 50%;
        transform: translateX(-50%); /* Центрирование по горизонтали */
    }

    .tooltip-bottom .tooltiptext::after {
        content: "";
        position: absolute;
        bottom: 100%; /* Стрелка сверху тултипа */
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: transparent transparent rgba(85, 85, 85, 0.9) transparent; /* Полупрозрачная стрелка */
    }

       .one-field, .two-field {
            padding: 0 10px;
            border-radius: 10px;
            margin-top: 12px;
            border: 2px solid #ffffff; /* Черная рамка */
            outline: 4px solid #000000; /* Белая рамка вокруг черной */
        }

        .one-field {
            background-color: #c2c2c2;
        }

        .two-field {
            background-color: #e3e8e6;
        }


        select.nechet-field {
            background-color: #e3e8e6;
            color: #000000; /* Черный цвет текста */
            border: 2px solid #000000; /* Черная рамка */
            outline: 4px solid #ffffff; /* Белая рамка вокруг черной */
            border-radius: 7px; /* Скругление углов */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Опционально: Добавление тени */
            padding: 3px; /* Отступ внутри элемента */
            font-size: 14px;
        }

        input.nechet-field, input.nemenyemye-field, input.chet-field {

            color: #000000; /* Черный цвет текста */
            border: 2px solid #000000; /* Черная рамка */
            outline: 4px solid #ffffff; /* Белая рамка вокруг черной */
            border-radius: 7px; /* Скругление углов */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Опционально: Добавление тени */
            padding: 3px; /* Отступ внутри элемента */
            font-size: 14px;
        }

        /* Стили для четных и нечетных полей */
        input.chet-field {
            background-color: #a8a8a8; /* темно-серый цвет фона */
        }

        input.nechet-field {
            background-color: #e3e8e6; /* бело-серый цвет фона */
        }

        input.nemenyemye-field {
            background-color: #b0b7c6; /* синий цвет фона */
        }

        #data-container {
            height: 55%; /* Задайте высоту, которая подходит для вашего дизайна */
            overflow-y: auto; /* Включаем вертикальную прокрутку */
            width: 99%; /* Ширина контейнера */
            position: fixed; /* Фиксируем позицию */
            top: calc(var(--height-top) + 12%); /* Позиционируем контейнер */
            padding: 0 10px; /* Отступ внутри элемента */
            background-color: #808080; /* Цвет фона, чтобы соответствовать общему стилю */
            z-index: 1; /* Убедитесь, что контейнер находится над другими элементами */
        }

        .logo {
        width: 98.1%;
            height: 99%;
<!--        background-size: cover;-->
            background-position: right;
            margin-bottom: 10px;
            border: 2px solid #000000;
             border-radius: 10px;
        }
    </style>
</head>
<body>

<div class="back-container">
    <div class="tooltip tooltip-bottom">
        <button id="fetchButtonHome" class="connt bbtn bbtn-size-1" type="button" >Назад</button>
        <span class="tooltiptext">Ну передумал и ладно, пойдем кофе попьем</span>
    </div>
</div>

<!-- Фиксированный заголовок -->
<div class="login-container1">

    <select class="polya1" id="responsible" name="responsible" required>
        <option value="" disabled selected>Ответственный</option>
        <!-- Опции будут заполнены динамически -->
    </select><br />
    <br />
    <select class="polya1" id="city" name="city">
        <option value="">Город</option>
        <option value="Москва">Москва</option>
        <option value="Мос.Обл">Мос.Обл</option>
        <option value="Брянск">Брянск</option>
        <option value="Тверь">Тверь</option>
        <option value="Смоленск">Смоленск</option>
    </select><br />
    <br />
    <select class="polya1" id="formaoplaty" name="formaoplaty">
        <option value="">Форма оплаты</option>
        <option value="По ТК">ПО ТК</option>
        <option value="По ТК др-банк">По ТК др банк</option>
        <option value="Самозанятый">Самозанятый</option>
        <option value="Ип">ИП</option>
        <option value="Не официально">Не официально</option>
    </select><br />
    <br />
    <select class="polya1" id="companyName" name="companyName" required>
        <option value="">Компания</option>
        <option value="ПРАЙМГРУПП">ПРАЙМГРУПП</option>
        <option value="ГРОССТРОЙ">ГРОССТРОЙ</option>
        <option value="Олимпик">Олимпик</option>
    </select><br />
    <br />
    <select class="polya1" id="dismissed" name="dismissed">
        <option value="">Не уволен</option>
        <option value="true">Уволен</option>
    </select>

        <button id="fetchButton" style="display: none;"></button>
    <div style="position: absolute; left: 45%; bottom: 10px;">
        <button id="saveAllButton" class="connt bbtn bbtn-size-2">Сохранить</button>
    </div>
    <br />

    </div>
<div class="login-container2">
    <img src="/images/logo-praym.jpg" alt="Логотип компании" class="logo" style="border: 2px solid #000000; border-radius: 10px;">
</div>
<div class="login-container">
        <input style="width: 90px;" type="text" name="2" value="Фамилия" readonly class="chet-field"/>
        <input style="width: 90px;" type="text" name="3" value="Имя" readonly class="nechet-field"/>
        <input style="width: 90px;" type="text" name="4" value="Отчество" readonly class="chet-field"/>
        <input style="width: 90px;" type="text" name="5" value="Телефон" readonly class="nechet-field"/>
        <input style="width: 110px;" type="text" name="7" value="Форма занятости" readonly class="chet-field"/>
        <input style="width: 90px;" type="text" name="8" value="Город" readonly class="nechet-field"/>
        <input style="width: 160px;" type="text" name="9" value="Номер счета" readonly class="chet-field"/>
        <input style="width: 110px;" type="text" name="10" value="Ответственный" readonly class="nechet-field"/>
        <input style="width: 110px;" type="text" name="11" value="Компания" readonly class="chet-field"/>
        <input style="width: 80px;" type="text" name="11" value="Уволен" readonly class="nechet-field"/>
</div>

<div id="data-container"></div>
<script>

<!--    const urll = "http://localhost:8080";-->
    const urll = "http://95.142.37.35";

    // Автоматически высчитываем высоту хедера и делаем отступ
    window.addEventListener('load', function() {
    const headerHeight = document.querySelector('.fixed-header').offsetHeight;
    document.getElementById('data-container').style.marginTop = `${headerHeight + 10}px`;
    });

    // Получаем текущий URL
 const url = window.location.href;

 // Используем регулярное выражение для извлечения числа в конце URL
 const match = url.match(/\/super-admin\/get-all-users-by-super-admin\/h\/([a-f0-9-]+)/);

    // Если число найдено, сохраняем его в переменную
    let initiatorId = null;
    if (match && match[1]) {
    initiatorId = match[1];
    console.log("Extracted UUID:", initiatorId);
    } else {
    console.log("Number not found in URL");
    }

 // Функция для загрузки списка администраторов
    function loadResponsibles() {
<!--        fetch(`http://localhost:8080/super-admin/get-admins/${initiatorId}`)-->
        fetch(`${urll}/super-admin/get-admins/${initiatorId}`)
        .then(response => {
             if (!response.ok) {
                 throw new Error(`Server responded with status: ${response.status}`);
            }
             return response.json();
         })
         .then(data => {
          const ownerLastNameSelect = document.getElementById('responsible');
          ownerLastNameSelect.innerHTML = ''; // Очищаем список перед заполнением

         // Добавляем первый элемент "Ответственный"
         const defaultOption = document.createElement('option');
         defaultOption.value = "";
         defaultOption.textContent = "Ответственный";
<!--            defaultOption.disabled = true;-->
<!--            defaultOption.selected = true;-->
         ownerLastNameSelect.appendChild(defaultOption);

         // Добавляем остальные элементы из данных
         data.forEach(admin => {
             const option = document.createElement('option');
             option.value = admin;
             option.textContent = admin;
             ownerLastNameSelect.appendChild(option);
         });
     })
     .catch(error => {
         console.error('Ошибка при загрузке списка администраторов:', error);
     });
}

 // Load responsibles when the page loads
 document.addEventListener('DOMContentLoaded', loadResponsibles);

 // Function to send GET request and display data
 async function fetchData() {
     try {
         // Get the selected values
         const responsible = document.getElementById('responsible').value;
         const city = document.getElementById('city').value;
         const formaoplaty = document.getElementById('formaoplaty').value;
         const companyName = document.getElementById('companyName').value;
         const dismissed = document.getElementById('dismissed').value;

         // Set parameters to null if the default option is selected
         const responsibleParam = responsible === "" ? null : responsible;
         const cityParam = city === "" ? null : city;
         const formaoplatyParam = formaoplaty === "" ? null : formaoplaty;
         const companyNameParam = companyName === "" ? null : companyName;
         const dismissedParam = dismissed === "" ? null : dismissed;

         // Build the URL with parameters

<!--         let url = `http://localhost:8080/super-admin/all-users-by-super-admin/${initiatorId}`;-->
         let url = `${urll}/super-admin/all-users-by-super-admin/${initiatorId}`;
         const params = [];

         if (responsibleParam) params.push(`responsible=${responsibleParam}`);
         if (cityParam) params.push(`city=${cityParam}`);
         if (formaoplatyParam) params.push(`formaoplaty=${formaoplatyParam}`);
         if (companyNameParam) params.push(`companyName=${companyNameParam}`);
         if (dismissedParam) params.push(`dismissed=${dismissedParam}`);

         if (params.length > 0) {
             url += `?${params.join('&')}`;
         }

         const response = await fetch(url);

         if (!response.ok) {
             throw new Error('Network response was not ok');
         }
         const data = await response.json();
         document.getElementById('data-container').innerHTML = '';
         data.forEach((item, index) => {
             const card = document.createElement('div');
             card.className = 'data-card';
             if (index % 2 === 0) {
                 card.classList.add('one-field');
             } else {
                 card.classList.add('two-field');
             }
             card.innerHTML = `
                 <input style="width: 15px;" type="hidden" id="id-${index}" name="id" value="${item.id}" readonly>
                 <input style="width: 90px;" type="text" id="lastName-${index}" name="lastName" value="${item.lastName}" required class="chet-field">
                 <input style="width: 90px;" type="text" id="name-${index}" name="name" value="${item.name}" required class="nechet-field">
                 <input style="width: 90px;" type="text" id="patronymic-${index}" name="patronymic" value="${item.patronymic}" required class="chet-field">
                 <input style="width: 90px;" type="text" id="phone-${index}" name="phone" value="${item.phone}" required class="nechet-field">
                 <input style="width: 110px;" type="text" id="category-${index}" name="category" value="${item.category}" required class="chet-field">
                 <input style="width: 90px;" type="text" id="city-${index}" name="city" value="${item.city}" required class="nechet-field">
                 <input style="width: 160px;" type="text" id="bankAccountNumber-${index}" name="bankAccountNumber" value="${item.bankAccountNumber}" required class="chet-field">
                 <input style="width: 110px;" type="text" id="ownerLastName-${index}" name="ownerLastName" value="${item.ownerLastName}" required class="nechet-field">
                 <input style="width: 110px;" type="text" id="companyName-${index}" name="companyName" value="${item.companyName}" required class="chet-field">
                 <select style="width: 85px;" id="dismissed-${index}" name="dismissed" class="nechet-field">
                     <option value="true" ${item.dismissed === true ? 'selected' : ''}>Да</option>
                     <option value="false" ${item.dismissed === false ? 'selected' : ''}>Нет</option>
                 </select>
             `;
             document.getElementById('data-container').appendChild(card);
         });
     } catch (error) {
         console.error('Error fetching data:', error);
         alert('Failed to fetch data. Please try again.');
     }
 }

 // обработчик изменений выпадающего списка
    document.getElementById('responsible').addEventListener('change', fetchData);
    document.getElementById('city').addEventListener('change', fetchData);
    document.getElementById('formaoplaty').addEventListener('change', fetchData);
    document.getElementById('companyName').addEventListener('change', fetchData);
    document.getElementById('dismissed').addEventListener('change', fetchData);

    // вызов данных после обработчика
    fetchData();

 // Function to collect data and send it to the server
 async function saveAllData() {
     const data = [];
     const cards = document.querySelectorAll('.data-card');
     cards.forEach((card, index) => {
         const item = {
             id: card.querySelector(`#id-${index}`).value,
             name: card.querySelector(`#name-${index}`).value,
             lastName: card.querySelector(`#lastName-${index}`).value,
             patronymic: card.querySelector(`#patronymic-${index}`).value,
             phone: card.querySelector(`#phone-${index}`).value,
             category: card.querySelector(`#category-${index}`).value,
             city: card.querySelector(`#city-${index}`).value,
             bankAccountNumber: card.querySelector(`#bankAccountNumber-${index}`).value,
             ownerLastName: card.querySelector(`#ownerLastName-${index}`).value,
             companyName: card.querySelector(`#companyName-${index}`).value,
             dismissed: card.querySelector(`#dismissed-${index}`).value === 'true'
         };
         data.push(item);
     });

     try {
<!--         const response = await fetch(`http://localhost:8080/super-admin/update-all-users/${initiatorId}`, {-->
         const response = await fetch(`${urll}/super-admin/update-all-users/${initiatorId}`, {
             method: 'POST',
             headers: {
                 'Content-Type': 'application/json'
             },
             body: JSON.stringify(data)
         });

         if (!response.ok) {
             throw new Error('Network response was not ok');
         }

         alert('Данные успешно сохранены!');
     } catch (error) {
         console.error('Error saving data:', error);
         alert('Failed to save data. Please try again.');
     }
 }

       const handleFormSubmit = async (url) => {
            try {
                const response = await fetch(url, { method: 'GET' });
                if (response.ok) {
                    const redirectUrl = await response.text(); // Получаем URL для редиректа
<!--                    window.location.href = `http://localhost:8080/${redirectUrl}`; // Выполняем редирект-->
                    window.location.href = `${urll}/${redirectUrl}`; // Выполняем редирект
                } else {
                    console.error('Ошибка при выполнении запроса:', response.statusText);
                }
            } catch (error) {
                console.error('Ошибка:', error);
            }
        };

        // Назначаем обработчики событий для кнопки "Назад"
        document.getElementById('fetchButtonHome').addEventListener('click', () => {
<!--            handleFormSubmit(`http://localhost:8080/super-admin/home-super-admin/${initiatorId}`);-->
            handleFormSubmit(`${urll}/super-admin/home-super-admin/${initiatorId}`);
        });

 // Attach the fetchData function to the button click event
 document.getElementById('fetchButton').addEventListener('click', fetchData);

 // Attach the saveAllData function to the "Сохранить все" button click event
 document.getElementById('saveAllButton').addEventListener('click', saveAllData);

 window.onload = fetchData;
</script>
</body>
</html>